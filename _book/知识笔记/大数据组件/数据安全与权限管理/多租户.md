# rangerç¼–è¯‘å’Œå®‰è£…

è…¾è®¯è¯¾å ‚ è§†é¢‘ï¼ˆ1.2.0ï¼‰

https://ke.qq.com/webcourse/index.html#cid=443147&term_id=100529499&taid=3859066770604811&type=1024&vid=5285890793895524135









## ä¸‹è½½

ä¸‹è½½ ranger

ç›®å‰ç‰ˆæœ¬ 2.0.0 

ä¸‹è½½æ¸ é“ï¼Œ

https://dist.apache.org/repos/dist/release/ranger/2.0.0/

ä¸‹äº†release ç¨³å®šç‰ˆï¼Œæ²¡æœ‰åƒå¤§éƒ¨åˆ†äººä» gitlhub ç›´æ¥ä¸‹è½½æºç ã€‚



## ç¼–è¯‘



### å‡†å¤‡å·¥ä½œ

```shell
cd /d/wsl/setup
 tar -xvf apache-ranger-2.0.0.tar.gz 

## ç›´æ¥æŠŠåå­—æ”¹äº†ï¼Œæœ‰æ—¶é—´å»ºè®®å»ºè½¯è¿æ¥
mv apache-ranger-2.0.0 ranger

```

æŸ¥çœ‹ æˆ‘æœ‰maven

```shell
mq5445@DESKTOP-7IL9SC5:/d/wsl/setup/ranger$ mvn --version
Apache Maven 3.6.0
Maven home: /usr/share/maven
Java version: 1.8.0_241, vendor: Oracle Corporation, runtime: /mnt/d/wsl/setup/java/jre
Default locale: en, platform encoding: UTF-8
OS name: "linux", version: "4.4.0-18362-microsoft", arch: "amd64", family: "unix"

```

æ ¹æ®cdh ç‰ˆæœ¬æ”¹ pom

https://docs.cloudera.com/documentation/enterprise/6/release-notes/topics/rg_cdh_63_packaging.html



CDH 6.3.2

| **Component**    | **Component Version** |
| :--------------- | :-------------------- |
| Apache Avro      | 1.8.2                 |
| Apache Flume     | 1.9.0                 |
| Apache Hadoop    | 3.0.0                 |
| Apache HBase     | 2.1.4                 |
| HBase Indexer    | 1.5                   |
| Apache Hive      | 2.1.1                 |
| Hue              | 4.4.0                 |
| Apache Impala    | 3.2.0                 |
| Apache Kafka     | 2.2.1                 |
| Kite SDK         | 1.0.0                 |
| Apache Kudu      | 1.10.0                |
| Apache Solr      | 7.4.0                 |
| Apache Oozie     | 5.1.0                 |
| Apache Parquet   | 1.9.0                 |
| Parquet-format   | 2.4.0                 |
| Apache Pig       | 0.17.0                |
| Apache Sentry    | 2.1.0                 |
| Apache Spark     | 2.4.0                 |
| Apache Sqoop     | 1.4.7                 |
| Apache ZooKeeper | 3.4.5                 |



å¯¹åº”ä¿®æ”¹ pom æˆ‘æ”¹äº†ä»¥ä¸‹è¿™äº›

```xml
<hadoop.version>3.0.0</hadoop.version>
<hive.version>2.1.1</hive.version>   <!-- è¿™ä¸ªä¼šè·Ÿhadoopç‰ˆæœ¬å†²çª åé¢ä¼šè¯´æ€ä¹ˆåš -->
<kafka.version>2.2.1</kafka.version>
<zookeeper.version>3.4.5</zookeeper.version>

<tomcat.embed.version>7.0.105</tomcat.embed.version> <!-- è¿™ä¸ªä½äºè¿™ä¸ªç‰ˆæœ¬ç”±å®‰å…¨æ¼æ´ -->

```

hbase çš„ç‰ˆæœ¬æœ‰é—®é¢˜ï¼Œæ”¹ä¸‹é¢çš„ä¼šæŠ¥é”™ã€‚
æ‰€ä»¥æ²¡æ”¹ä¿ç•™äº† hbase 2.0.2å»ç¼–è¯‘ï¼Œä¹Ÿæœ‰äººå’Œæˆ‘ä¸€æ ·è¿™é‡Œä¼šæŠ¥é”™, ä¸‹é¢çš„ä¸è¦æŒ‰cdhçš„æ”¹ã€‚ä¼šæœ‰é—®é¢˜


```xml
    <hbase.version>2.1.4</hbase.version>
    <hbase-shaded-protobuf>2.1.4</hbase-shaded-protobuf>
    <hbase-shaded-netty>2.1.4</hbase-shaded-netty>
    <hbase-shaded-miscellaneous>2.1.4</hbase-shaded-miscellaneous>

<sqoop.version>1.4.7</sqoop.version>

```



### ç¼–è¯‘


å¼€å§‹ç¼–è¯‘

```shell

mvn clean compile package assembly:assembly -Dpmd.skip=true  install -DskipTests -Drat.skip=true
```

è¿™é‡Œ è·³è¿‡äº† pmd é™æ€ä»£ç æ£€æµ‹ã€‚åŠ ä¸Šä¼šæŠ¥é”™ã€‚ç‰¹åˆ«è›‹ç–¼ã€‚æäº†2å¤©è¿™ä¸ªã€‚



çœ‹æœ‰çš„äººè¯´è¦è£… git å’Œ python

æˆ‘çš„éƒ½æœ‰

python ç‰ˆæœ¬ 

```she
mq5445@DESKTOP-7IL9SC5:~$ python --version
Python 2.7.17
```

```shell
Downloaded from alimaven: http://maven.aliyun.com/nexus/content/groups/public/net/minidev/json-smart/maven-metadata.xml (850 B at 435 B/s)
```

è¿™é‡Œè¡¥å……æ·»åŠ äº† osc çš„æºï¼Œali çš„ä¼¼ä¹æ²¡æœ‰jboss

```shell
sudo vim /etc/maven/settings.xml
```



æ‰¾åˆ° mirrorsä½ç½®é‡Œæ·»åŠ 

```xml

<mirror>
Â  Â  Â  Â  <id>osc</id>
Â  Â  Â  Â  <mirrorOf>*</mirrorOf>
Â  Â  Â  Â  <url>http://maven.oschina.net/content/groups/public/</url>
Â  Â  </mirror>

```



hbase ç‰ˆæœ¬æŠ¥é”™ã€‚çœ‹æœ‰çš„è€å“¥ä¹Ÿè¿™æŠ¥é”™ã€‚

æŸ¥äº†ä¸‹

hive-agent æŠ¥é”™ï¼Œé»˜è®¤æ˜¯3.1.2 

æ”¹2.1.1 æœ‰é—®é¢˜



æŸ¥äº†ä¸‹ ranger 0.7 ç‰ˆæœ¬æ‰æ”¯æŒ2.1.1 è¿™ä¸ªç‰ˆæœ¬ã€‚

cdh çš„è¿™ä¸ªhiveç‰ˆæœ¬å¤ªè€äº†

ç¼–è¯‘å®Œäº†ã€‚ç”¨ä¸èµ·æ¥ã€‚

å¤§ä½¬çš„åšæ³•ã€‚

https://blog.csdn.net/tomalun/article/details/105490214



ä¸‹äº†ä¸ª ranger 1.2.0 æŠŠå¯¹åº”çš„ hive-agent è¦†ç›–æ‰ ranger 2.0.0 çš„ hive-agent 



ç¬¬10æ¬¡ç¼–è¯‘å

```shell
[INFO] ------------------------------------------------------------------------
[INFO] Reactor Summary:
[INFO] 
[INFO] ranger 2.0.0 ....................................... SUCCESS [  0.714 s]
[INFO] Jdbc SQL Connector 2.0.0 ........................... SUCCESS [  0.362 s]
[INFO] Credential Support 2.0.0 ........................... SUCCESS [  1.299 s]
[INFO] Audit Component 2.0.0 .............................. SUCCESS [  1.586 s]
[INFO] Common library for Plugins 2.0.0 ................... SUCCESS [  2.552 s]
[INFO] Installer Support Component 2.0.0 .................. SUCCESS [  0.253 s]
[INFO] Credential Builder 2.0.0 ........................... SUCCESS [  1.004 s]
[INFO] Embedded Web Server Invoker 2.0.0 .................. SUCCESS [  1.253 s]
[INFO] Key Management Service 2.0.0 ....................... SUCCESS [  1.781 s]
[INFO] ranger-plugin-classloader 2.0.0 .................... SUCCESS [  0.310 s]
[INFO] HBase Security Plugin Shim 2.0.0 ................... SUCCESS [  2.004 s]
[INFO] HBase Security Plugin 2.0.0 ........................ SUCCESS [  2.483 s]
[INFO] Hdfs Security Plugin 2.0.0 ......................... SUCCESS [  1.517 s]
[INFO] Hive Security Plugin 1.2.0 ......................... SUCCESS [  2.599 s]
[INFO] Knox Security Plugin Shim 2.0.0 .................... SUCCESS [  1.584 s]
[INFO] Knox Security Plugin 2.0.0 ......................... SUCCESS [  2.815 s]
[INFO] Storm Security Plugin 2.0.0 ........................ SUCCESS [  1.566 s]
[INFO] YARN Security Plugin 2.0.0 ......................... SUCCESS [  1.439 s]
[INFO] Ozone Security Plugin 2.0.0 ........................ SUCCESS [  1.794 s]
[INFO] Ranger Util 2.0.0 .................................. SUCCESS [  3.815 s]
[INFO] Unix Authentication Client 2.0.0 ................... SUCCESS [  0.760 s]
[INFO] Security Admin Web Application 2.0.0 ............... SUCCESS [01:05 min]
[INFO] KAFKA Security Plugin 2.0.0 ........................ SUCCESS [  1.394 s]
[INFO] SOLR Security Plugin 2.0.0 ......................... SUCCESS [  3.854 s]
[INFO] NiFi Security Plugin 2.0.0 ......................... SUCCESS [  1.214 s]
[INFO] NiFi Registry Security Plugin 2.0.0 ................ SUCCESS [  1.188 s]
[INFO] Unix User Group Synchronizer 2.0.0 ................. SUCCESS [  1.736 s]
[INFO] Ldap Config Check Tool 2.0.0 ....................... SUCCESS [  0.456 s]
[INFO] Unix Authentication Service 2.0.0 .................. SUCCESS [  1.300 s]
[INFO] KMS Security Plugin 2.0.0 .......................... SUCCESS [  1.463 s]
[INFO] Tag Synchronizer 2.0.0 ............................. SUCCESS [  1.631 s]
[INFO] Hdfs Security Plugin Shim 2.0.0 .................... SUCCESS [  1.128 s]
[INFO] Hive Security Plugin Shim 2.0.0 .................... SUCCESS [  3.083 s]
[INFO] YARN Security Plugin Shim 2.0.0 .................... SUCCESS [  1.496 s]
[INFO] OZONE Security Plugin Shim 2.0.0 ................... SUCCESS [  1.766 s]
[INFO] Storm Security Plugin shim 2.0.0 ................... SUCCESS [  1.422 s]
[INFO] KAFKA Security Plugin Shim 2.0.0 ................... SUCCESS [  1.164 s]
[INFO] SOLR Security Plugin Shim 2.0.0 .................... SUCCESS [  1.994 s]
[INFO] Atlas Security Plugin Shim 2.0.0 ................... SUCCESS [  1.349 s]
[INFO] KMS Security Plugin Shim 2.0.0 ..................... SUCCESS [  1.464 s]
[INFO] ranger-examples 2.0.0 .............................. SUCCESS [  0.113 s]
[INFO] Ranger Examples - Conditions and ContextEnrichers 2.0.0 SUCCESS [  1.155 s]
[INFO] Ranger Examples - SampleApp 2.0.0 .................. SUCCESS [  0.264 s]
[INFO] Ranger Examples - Ranger Plugin for SampleApp 2.0.0  SUCCESS [  1.239 s]
[INFO] Ranger Tools 2.0.0 ................................. SUCCESS [  1.179 s]
[INFO] Atlas Security Plugin 2.0.0 ........................ SUCCESS [  1.484 s]
[INFO] Sqoop Security Plugin 2.0.0 ........................ SUCCESS [  1.313 s]
[INFO] Sqoop Security Plugin Shim 2.0.0 ................... SUCCESS [  1.196 s]
[INFO] Kylin Security Plugin 2.0.0 ........................ SUCCESS [  1.507 s]
[INFO] Kylin Security Plugin Shim 2.0.0 ................... SUCCESS [  1.401 s]
[INFO] Elasticsearch Security Plugin Shim 2.0.0 ........... SUCCESS [  0.454 s]
[INFO] Elasticsearch Security Plugin 2.0.0 ................ SUCCESS [  1.295 s]
[INFO] Presto Security Plugin 2.0.0 ....................... SUCCESS [  1.310 s]
[INFO] Presto Security Plugin Shim 2.0.0 .................. SUCCESS [  1.307 s]
[INFO] Unix Native Authenticator 2.0.0 .................... SUCCESS [  0.695 s]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  42:43 min
[INFO] Finished at: 2020-07-22T10:12:59+08:00
[INFO] ------------------------------------------------------------------------

```

ç»“æœï¼š

```shell
root@DESKTOP-7IL9SC5:/mnt/d/wsl/setup/ranger# ll target/
total 1534276
drwxr-xr-x 1 root   root        4096 Jul 22 10:10 ./
drwxrwxr-x 1 mq5445 mq5445      4096 Jul 22 09:30 ../
-rw-r--r-- 1 root   root          30 Jul 22 10:10 .plxarc
drwxr-xr-x 1 root   root        4096 Jul 22 09:30 antrun/
drwxr-xr-x 1 root   root        4096 Jul 22 10:09 archive-tmp/
drwxr-xr-x 1 root   root        4096 Jul 22 09:30 maven-shared-archive-resources/
-rw-r--r-- 1 root   root   215913533 Jul 22 10:01 ranger-2.0.0-admin.tar.gz
-rw-r--r-- 1 root   root   217022494 Jul 22 10:03 ranger-2.0.0-admin.zip
-rw-r--r-- 1 root   root    27540587 Jul 22 10:06 ranger-2.0.0-atlas-plugin.tar.gz
-rw-r--r-- 1 root   root    27570212 Jul 22 10:06 ranger-2.0.0-atlas-plugin.zip
-rw-r--r-- 1 root   root    30983732 Jul 22 10:09 ranger-2.0.0-elasticsearch-plugin.tar.gz
-rw-r--r-- 1 root   root    31019906 Jul 22 10:09 ranger-2.0.0-elasticsearch-plugin.zip
-rw-r--r-- 1 root   root    26575282 Jul 22 09:53 ranger-2.0.0-hbase-plugin.tar.gz
-rw-r--r-- 1 root   root    26594864 Jul 22 09:53 ranger-2.0.0-hbase-plugin.zip
-rw-r--r-- 1 root   root    23709141 Jul 22 09:51 ranger-2.0.0-hdfs-plugin.tar.gz
-rw-r--r-- 1 root   root    23735788 Jul 22 09:51 ranger-2.0.0-hdfs-plugin.zip
-rw-r--r-- 1 root   root    23745317 Jul 22 09:52 ranger-2.0.0-hive-plugin.tar.gz
-rw-r--r-- 1 root   root    23769378 Jul 22 09:53 ranger-2.0.0-hive-plugin.zip
-rw-r--r-- 1 root   root    39811408 Jul 22 09:55 ranger-2.0.0-kafka-plugin.tar.gz
-rw-r--r-- 1 root   root    39847327 Jul 22 09:56 ranger-2.0.0-kafka-plugin.zip
-rw-r--r-- 1 root   root    90070439 Jul 22 10:04 ranger-2.0.0-kms.tar.gz
-rw-r--r-- 1 root   root    90175690 Jul 22 10:05 ranger-2.0.0-kms.zip
-rw-r--r-- 1 root   root    28272440 Jul 22 09:54 ranger-2.0.0-knox-plugin.tar.gz
-rw-r--r-- 1 root   root    28295654 Jul 22 09:54 ranger-2.0.0-knox-plugin.zip
-rw-r--r-- 1 root   root    23684723 Jul 22 10:08 ranger-2.0.0-kylin-plugin.tar.gz
-rw-r--r-- 1 root   root    23718242 Jul 22 10:08 ranger-2.0.0-kylin-plugin.zip
-rw-r--r-- 1 root   root       34256 Jul 22 10:04 ranger-2.0.0-migration-util.tar.gz
-rw-r--r-- 1 root   root       37740 Jul 22 10:04 ranger-2.0.0-migration-util.zip
-rw-r--r-- 1 root   root    26126862 Jul 22 09:57 ranger-2.0.0-ozone-plugin.tar.gz
-rw-r--r-- 1 root   root    26159348 Jul 22 09:57 ranger-2.0.0-ozone-plugin.zip
-rw-r--r-- 1 root   root    39654366 Jul 22 10:10 ranger-2.0.0-presto-plugin.tar.gz
-rw-r--r-- 1 root   root    39691150 Jul 22 10:10 ranger-2.0.0-presto-plugin.zip
-rw-r--r-- 1 root   root    22146467 Jul 22 10:05 ranger-2.0.0-ranger-tools.tar.gz
-rw-r--r-- 1 root   root    22156287 Jul 22 10:05 ranger-2.0.0-ranger-tools.zip
-rw-r--r-- 1 root   root    26905522 Jul 22 09:58 ranger-2.0.0-solr-plugin.tar.gz
-rw-r--r-- 1 root   root    26938293 Jul 22 09:58 ranger-2.0.0-solr-plugin.zip
-rw-r--r-- 1 root   root       42230 Jul 22 10:03 ranger-2.0.0-solr_audit_conf.tar.gz
-rw-r--r-- 1 root   root       45636 Jul 22 10:03 ranger-2.0.0-solr_audit_conf.zip
-rw-r--r-- 1 root   root    23695951 Jul 22 10:07 ranger-2.0.0-sqoop-plugin.tar.gz
-rw-r--r-- 1 root   root    23724222 Jul 22 10:07 ranger-2.0.0-sqoop-plugin.zip
-rw-r--r-- 1 root   root     4071859 Jul 22 10:06 ranger-2.0.0-src.tar.gz
-rw-r--r-- 1 root   root     6340193 Jul 22 10:06 ranger-2.0.0-src.zip
-rw-r--r-- 1 root   root    36938489 Jul 22 09:54 ranger-2.0.0-storm-plugin.tar.gz
-rw-r--r-- 1 root   root    36963193 Jul 22 09:55 ranger-2.0.0-storm-plugin.zip
-rw-r--r-- 1 root   root    33709608 Jul 22 10:04 ranger-2.0.0-tagsync.tar.gz
-rw-r--r-- 1 root   root    33720483 Jul 22 10:04 ranger-2.0.0-tagsync.zip
-rw-r--r-- 1 root   root    16191997 Jul 22 10:03 ranger-2.0.0-usersync.tar.gz
-rw-r--r-- 1 root   root    16208427 Jul 22 10:04 ranger-2.0.0-usersync.zip
-rw-r--r-- 1 root   root    23701001 Jul 22 09:56 ranger-2.0.0-yarn-plugin.tar.gz
-rw-r--r-- 1 root   root    23730557 Jul 22 09:57 ranger-2.0.0-yarn-plugin.zip
-rw-r--r-- 1 root   root           5 Jul 22 10:10 version

```





## å®‰è£…Rangeræ§åˆ¶å°ï¼šRanger-admin



è¿™é‡ŒåˆæŠ˜è…¾äº†å‡ ä¸ªå°æ—¶ï¼Œè¿mysqlä¸€ç›´åœ¨æŠ¥é”™

```shell
tar -zxvf ranger-2.0.0-admin.tar.gz
```

```shell
vim install.properties
```



è®¾ç½®äº†ä¸€å¤§å † è¿mysql çš„

```shell
db_root_user=root
db_root_password=Bdp@boc01!
db_host=22.188.12.73

db_name=ranger
db_user=ranger
db_password=Bdp@boc01!

rangerAdmin_password=Bdp@boc01!
rangerTagsync_password=Bdp@boc01!
rangerUsersync_password=Bdp@boc01!
keyadmin_password=Bdp@boc01!


#audit_store=db  å…ˆæ²¡å¼€å®¡è®¡ æˆ‘è‡ªå·±æ„Ÿè§‰ç”¨å¤„ä¸å¤§
audit_db_name=ranger_audit
audit_db_user=ranger_audit
audit_db_password=Bdp@boc01!

policymgr_http_enabled=true
policymgr_https_keystore_file=
policymgr_https_keystore_keyalias=rangeradmin
policymgr_https_keystore_password=Bdp@boc01!


```



è·‘èµ·æ¥ä¸€ç›´åœ¨æŠ¥å¦‚ä¸‹é”™è¯¯



```shell
2020-07-15 17:26:19,354  [JISQL] /data/app/jdk11/jdk-11.0.5/bin/java  -cp /data/ranger/lib/mysql-connector-java-5.1.38.jar:/data/ranger/target/ranger-2.0.0-admin/jisql/lib/* org.apache.util.sql.Jisql -driver mysqlconj -cstring jdbc:mysql://22.188.12.73/ranger -u 'ranger' -p '********' -noheader -trim -c \;  -query "select 1;"
Wed Jul 15 17:26:20 CST 2020 WARN: Establishing SSL connection without server's identity verification is not recommended. According to MySQL 5.5.45+, 5.6.26+ and 5.7.6+ requirements SSL connection must be established by default if explicit option isn't set. For compliance with existing applications not using SSL the verifyServerCertificate property is set to 'false'. You need either to explicitly disable SSL by setting useSSL=false, or set useSSL=true and provide truststore for server certificate verification.
SQLException : SQL state: 42000 com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Access denied for user 'ranger'@'22.188.12.73' to database 'ranger' ErrorCode: 1044
2020-07-15 17:26:20,524  [E] Can't establish connection!! Exiting..
2020-07-15 17:26:20,524  [I] Please run DB setup first or contact Administrator..
2020-07-15 17:26:20,540  [E] 'setup_mode' not found in /data/ranger/target/ranger-2.0.0-admin/install.properties file while getting....!!

```



æŠ¥é”™å¤§æ¦‚æ„æ€æ˜¯æ²¡æœ‰æƒé™

root ç™»è¿›å»ï¼Œå‘ç°root æœ¬èº«æ²¡æœ‰æœ¬åœ°ç™»é™†æƒé™

 æ²¡æœ‰ /tmp/mysql.sock



æŸ¥çœ‹ /etc/my.cnf

æ–°å¢å¯¹åº”å‘½ä»¤æŒ‡å‘å¯¹åº”mysqld é…ç½®çš„sock

```shell
[clinet]
sock=/ccc/mysql.sock

[mysql]
sock=/ccc/mysql.sock
```



æ”¹å®Œå‘ç° root æœ¬åœ°å¯ä»¥è¿›å»äº†ï¼Œä½†æ˜¯è¿˜æ˜¯æŠ¥ä¸Šé¢çš„é”™è¯¯

çœ‹äº†ä¸‹æŠ¥é”™çš„ä½ç½®ä¼¼ä¹æœ‰åŒºåˆ«ã€‚ç½‘ä¸Šæ‰¾äº†ä¸‹ï¼Œæ˜¯root -h æŒ‡å®šå¯¹åº”ipæ˜¯ æ²¡æœ‰grant æƒé™



```sql
use mysql ;
select * from user where user='root' ;
```

```sql
update user set grant_priv='Y' where User='root' ;
FLUSH PRIVILEGES;
```



åˆå§‹åŒ– åŠ å¯åŠ¨web

```shell
./setup.sh
ews/ranger-admin-services.sh start
```

å¯åŠ¨åå¯ä»¥çœ‹åˆ° 6080 ç«¯å£çš„webç«¯











## å®‰è£…ranger Usersync

https://blog.csdn.net/andyguan01_2/article/details/88950551

éœ€è¦ä½¿ç”¨rootç”¨æˆ·



Ranger Usersyncä¼šå°†linuxç³»ç»Ÿç”¨æˆ·åŒæ­¥åˆ°rangeræ•°æ®åº“ã€‚

**6.1 ä¿®æ”¹é…ç½®æ–‡ä»¶install.properties**

```
cd /u01/app/ranger-2.0.0/ranger-2.0.0-SNAPSHOT-usersync
vi install.properties
12
```

ä¿®æ”¹çš„å‚æ•°å¦‚ä¸‹ï¼š

```
POLICY_MGR_URL=http://10.200.4.117:6080
SYNC_SOURCE=unix
#å¤šä¹…åŒæ­¥ä¸€æ¬¡æ•°æ®ï¼Œå•ä½ä¸ºåˆ†é’Ÿ
SYNC_INTERVAL=1
logdir=/data/ranger/logs/usersync
12345
```

**6.2 æ‰§è¡Œåˆå§‹åŒ–è®¾ç½®**

æ‰§è¡Œ.ï¼š

```
/setup.sh
1
```

**6.3 å¯åŠ¨Ranger Usersync**

æ‰§è¡Œï¼š

```
./ranger-usersync-services.sh start
1
```

ranger-usersync-services.shçš„å‚æ•°å¦‚ä¸‹ï¼š

```
[root@oracle02 ranger-2.0.0-SNAPSHOT-usersync]# ./ranger-usersync-services.sh
Invalid argument [];
Usage: Only start | stop | restart | version, are supported.
123
```

éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸï¼šæ‰“å¼€Rangeræ§åˆ¶å°é¡µé¢ï¼Œç‚¹å‡»â€œSettings->Users/Groupsâ€ï¼Œå¯ä»¥çœ‹åˆ°ä»LinuxåŒæ­¥è¿‡æ¥çš„ç”¨æˆ·ä¿¡æ¯åˆ™è¯´æ˜æˆåŠŸã€‚å¦‚ä¸‹ï¼š
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20190402172337802.png)

## è£…hiveæ’ä»¶



### åœ¨hive-server2 èŠ‚ç‚¹å®‰è£…hive-plugin

å‚è€ƒæ–‡æ¡£ ï¼ˆps:å¤§ä½¬å¾ˆå¥”æ”¾ï¼Œæ ¼å¼ä¸€å›¢ç³Š ğŸ¤®ï¼‰

https://blog.csdn.net/huangyq5240/article/details/102721679



ç›´æ¥ç²˜çš„å¤§ä½¬çš„ï¼Œç›®å½• 6.3.2 å¯¹åº”è¦æ¢ï¼Œä¸»è¦å°±æ˜¯ æŠŠ ranger-hive-pluginçš„åŒ…æ”¾åˆ° cdh é‡Œå»

```shell
## æ”¾åˆ°å¯¹åº”çš„cdhç›®å½•ä¸‹å» 
cp /home/xxxxxxx/ranger-0.5.4-SNAPSHOT-hive-plugin.tar.gz /opt/cloudera/parcels/CDH/lib

## è½¯è¿æ¥æˆ–æ”¹åå­— 
 ln -s ranger-0.5.4-SNAPSHOT-hive-plugin ranger-hive-plugin
 
```



```shell
 ## æ”¹é…ç½®
 cd ranger-hive-plugin/
 vim install.properties
```



```properties
#å¯¹åº”æ‰¾åˆ°æ›´æ”¹
## å¿…é¡»æ”¹
POLICY_MGR_URL=http://172.17.8.94:6080
REPOSITORY_NAME=hivedev

## å®¡è®¡ï¼ˆæˆ‘æ²¡æ”¹ï¼‰
XAAUDIT.SOLR.ENABLE=true
XAAUDIT.SOLR.URL=http://172.17.8.4:6083/solr/ranger_audits
XAAUDIT.SOLR.FILE_SPOOL_DIR=/var/log/hive/audit/solr/spool

## æ”¹
CUSTOM_USER=hive
CUSTOM_GROUP=hive

```



å¯åŠ¨ï¼Œæœ€ç»ˆå…¶å®æ˜¯ è¦é‡å¯ hiveserver2 æ‰ä¼šç”Ÿæ•ˆï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘è§‰å¾—åªæ˜¯ä¸œè¥¿åˆ†å‘äº†ä¸‹

```shell
#å¯åŠ¨æ’ä»¶ï¼Œæ„Ÿè§‰å…¶å®å°±æ˜¯ æŠŠä¸œè¥¿ä¸€é¡¿å¤åˆ¶ï¼Œæ²¡å…·ä½“çœ‹
./enable-hive-plugin.sh

## /opt/cloudera/parcels/CDH/lib/ranger-hive-plugin/enable-hive-plugin.sh
```



æ”¹cm-agent å¯¹åº”çš„åˆ†å‘ç¨‹åºï¼Œæˆ‘æ„Ÿè§‰æ˜¯ ä¿è¯rangerç”Ÿæˆçš„ä¸‰ä¸ªé…ç½®æ–‡ä»¶å¯ä»¥åŒæ­¥åˆ°å¯¹åº”çš„ impala ,hivemeta, hiveserver2 ç­‰æœåŠ¡ä¸Šå»

```shell
find / -name "cloudera-config.sh" 
## æ‰¾ä¸ªåˆé€‚çš„ï¼Œå¯¹åº”çš„ä½ç½®
## å¤§ä½¬çš„ä½ç½® sudo vim /usr/lib64/cmf/service/common/cloudera-config.sh
vim /opt/cloudera/cm-agent/service/common/cloudera-config.sh
```







```shell
# When created, the final resting place of config files is unknown,
# so it is marked as {{CMF_CONF_DIR}}. We know what this directory will
# be here in this script, so search-replace it.
replace_conf_dir() {
find $CONF_DIR -type f ! -path "$CONF_DIR/logs/*" ! -name "*.log" ! -name "*.keytab" ! -name "*jceks" -exec perl -pi -e "s#{{CMF_CONF_DIR}}#$CONF_DIR#g" {} \;

### ä»¥ä¸‹ä¸ºæ–°å¢,æŠŠå¯¹åº”çš„ranger çš„é…ç½®åŒæ­¥åˆ° ä¸»é…ç½®, hive

[[ -e /etc/hive/conf/ranger-hive-audit.xml ]] && {
scp /etc/hive/conf/ranger-hive-audit.xml $CONF_DIR/
scp /etc/hive/conf/ranger-hive-security.xml $CONF_DIR/
scp /etc/hive/conf/ranger-policymgr-ssl.xml $CONF_DIR/ ;
}

### ä»¥ä¸‹æ˜¯ yarn çš„
[[ -e /etc/hadoop/conf/ranger-yarn-audit.xml ]] && {
scp  /etc/hadoop/conf/ranger-policymgr-ssl.xml     $CONF_DIR/
scp  /etc/hadoop/conf/ranger-security.xml          $CONF_DIR/
scp  /etc/hadoop/conf/ranger-yarn-audit.xml        $CONF_DIR/
scp  /etc/hadoop/conf/ranger-yarn-security.xml     $CONF_DIR/ ;}


}
```

```shell
sh scpCycle.sh  /data/opt_cloudera/cm-agent/service/common/cloudera-config.sh
sh cycle.sh "chown cloudera-scm:cloudera-scm /data/opt_cloudera/cm-agent/service/common/cloudera-config.sh ;chmod 755 /data/opt_cloudera/cm-agent/service/common/cloudera-config.sh"

sh scpCycle.sh  /opt/cloudera/parcels/CDH/lib/ranger-hive-plugin
```



ä¹‹åè¿˜æ˜¯æŠ¥äº†å¦ä¸€ä¸ªé”™ï¼š

```css
Error: Could not open client transport with JDBC Uri: jdbc:hive2://10.10.6.105:10000: Failed to open new session: java.lang.IllegalArgumentException: Cannot modify hive.query.redaction.rules at runtime. It is not in list of params that are allowed to be modified at runtime (state=08S01,code=0)
1
```

æŠ¥é”™æåŠcan not modify hive.query.redaction.rules
å»æŸ¥çœ‹è¿™ä¸ªåœ¨å“ªå„¿ï¼š
cd /etc/hive
grep -rni â€œhive.query.redaction.rulesâ€
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200513160713470.png)
å»æ‰é…ç½®æ–‡ä»¶ä¸­ hive-env.sh ä¸­ç¬¬7è¡ŒåŠ è½½äº†è¿™ä¸ªé…ç½®é¡¹hive.query.redaction.rulesæ ¡éªŒå‚æ•°ã€‚







```shell
### ä»¥ä¸‹ä¸ºå…¨éƒ¨é…å®Œå æˆ‘æ‰¾åˆ°çš„ç»“æœ

[root@hshv01 ~]# find / -name "ranger-hive-audit.xml"
/run/cloudera-scm-agent/process/1898-host-inspector/ranger-hive-audit.xml
/run/cloudera-scm-agent/process/1863-impala-IMPALAD/ranger-hive-audit.xml
/run/cloudera-scm-agent/process/1843-hive-HIVEMETASTORE/ranger-hive-audit.xml
/run/cloudera-scm-agent/process/1842-hive-HIVESERVER2/ranger-hive-audit.xml
/run/cloudera-scm-agent/process/1837-impala-IMPALAD/ranger-hive-audit.xml
/run/cloudera-scm-agent/process/1816-hive-HIVESERVER2/ranger-hive-audit.xml
/run/cloudera-scm-agent/process/1817-hive-HIVEMETASTORE/ranger-hive-audit.xml
/etc/hive/conf.cloudera.hive/ranger-hive-audit.xml
/opt/cloudera/parcels/CDH-6.3.2-1.cdh6.3.2.p0.1605554/lib/ranger-hive-plugin/install/conf.templates/enable/ranger-hive-audit.xml
```



### CDHé…ç½®é…ç½®æƒé™å¯ç”¨



ç»§ç»­å‚è€ƒä¸Šé¢ é…0.5 ranger çš„å¤§ä½¬ï¼Œè¿™é‡Œå¼€å§‹æ hive çš„æƒé™å¼€å¯

```xml
<property>
<name>hive.security.authorization.enabled</name>
<value>true</value>
</property>
<property>
<name>hive.security.authorization.manager</name>
<value>org.apache.ranger.authorization.hive.authorizer.RangerHiveAuthorizerFactory</value>
</property>
<property>
<name>hive.security.authenticator.manager</name>
<value>org.apache.hadoop.hive.ql.security.SessionStateUserAuthenticator</value>
</property>
<property>
<name>hive.conf.restricted.list</name>
<value>hive.security.authorization.enabled,hive.security.authorization.manager,hive.security.authenticator.manager</value>
</property>

<!-- è¿æ¥å¼‚å¸¸è§£å†³ -->
<!-- è¿æ¥å¼‚å¸¸è§£å†³ ,æ‰€æœ‰å‚æ•° è¦æ±‚å†™ä¸ºvar.  ,å¼•ç”¨æ—¶ä½¿ç”¨ ${hiveconf:var.xxx} æ¨¡å¼-->
<property>
    <name>hive.security.authorization.sqlstd.confwhitelist.append</name>
    <value>mapred.*|hive.*|mapreduce.*|spark.*|var.*|flink.*</value>
</property>
<property>
    <name>hive.security.authorization.sqlstd.confwhitelist</name>
    <value>mapred.*|hive.*|mapreduce.*|spark.*|var.*|flink.*</value>
</property>


â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºCSDNåšä¸»ã€Œhuangyq5240ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/huangyq5240/article/details/102721679


```

å®é™…åœ¨ cdh é‡Œ åœ¨ hive é«˜çº§é‡Œæ·»åŠ æƒé™ç®¡ç†

åœ¨hive site é‡Œæœ‰å¾ˆå¤šï¼Œå¯¹åº” é…ç½®æ„Ÿè§‰æ˜¯ ç”¨äº hive client çš„æƒé™å°é”

![image-20200724153829420](.assets/image-20200724153829420.png)



### ranger-admin æ·»åŠ ä¾èµ–åŒ…



é…ç½®ranger-admin é‡Œæ·»åŠ  hive-dev 

![image-20200803112824811](.assets/image-20200803112824811.png)





test connection å¤±è´¥

https://m.cppentry.com/bencandy.php?fid=117&id=186236



éœ€è¦åœ¨ admin çš„ ä¸‹æ–°å¢å¯¹åº”çš„ jdbc çš„ libåŒ… ï¼ˆå¥½åƒæ˜¯ ç¡®å®æ²¡æœ‰å¯¹åº”çš„åŒ…ï¼Œæ„Ÿè§‰æœ€å¥½åšè½¯è¿æ¥ï¼Œå›å¤´æœ‰ç©ºå†æ”¹ï¼‰



```shell
from_dir=/opt/cloudera/parcels/CDH-6.3.2-1.cdh6.3.2.p0.1605554/jars
## dest_dir=/data/ranger/ranger-2.0.0-admin/ews/webapp/WEB-INF/classes/ranger-plugins/
dest_dir=/app/ranger_admin/ews/webapp/WEB-INF/classes/ranger-plugins/


cp -r  ${from_dir}/hive-common*.jar ${dest_dir}/hive   
cp -r  ${from_dir}/hive-jdbc*.jar   ${dest_dir}//hive     
cp -r  ${from_dir}/hive-exec*.jar   ${dest_dir}/hive     
cp -r  ${from_dir}/hive-metastore*.jar ${dest_dir}/hive
cp -r  ${from_dir}/hive-service*.jar ${dest_dir}/hive  


scp -r  ${from_dir}/hadoop-yarn-api-3.0.0-cdh6.3.2.jar  ${dest_dir}/yarn/hadoop-yarn-api-3.0.0.jar
scp -r  ${from_dir}/hadoop-common-3.0.0-cdh6.3.2.jar   ${dest_dir}/yarn/hadoop-common-3.0.0.jar 
scp -r  ${from_dir}/hadoop-yarn-server-resourcemanager*.jar   ${dest_dir}/yarn/hadoop-common-3.0.0.jar

```



test æˆåŠŸï¼Œsave æ—¶ä¼šè½¬åœˆã€‚æ—¶é—´å¾ˆé•¿ï¼ˆæˆ‘æ˜¯ç­‰äº†10åˆ†é’Ÿä»¥ä¸Šï¼‰ï¼Œç­‰ã€‚





### é‡å¯hiveserver2 

cdh ä¸Šæ“ä½œé‡å¯ hiveserver2 



### é…ç½®å¯¹åº”é…ç½®hiveç­–ç•¥





## yarnæ’ä»¶



### æŠŠåŒ…æ”¾åˆ°cdh è¿™ä¸ªç›®å½•ä¸‹

ç›´æ¥ç²˜çš„å¤§ä½¬çš„ï¼Œç›®å½• 6.3.2 å¯¹åº”è¦æ¢ï¼Œä¸»è¦å°±æ˜¯ æŠŠ ranger-hive-pluginçš„åŒ…æ”¾åˆ° cdh é‡Œå»

```shell

## è§£å¼€åŒ… æ”¹åå­—ä¸º ranger-yarn-plugin
tar -zxvf *yarn*.gz
mv *yarn*-plugin   ranger-yarn-plugin

## æ”¾åˆ°å¯¹åº”çš„cdhç›®å½•ä¸‹å» 
mv  ranger-yarn-plugin /opt/cloudera/parcels/CDH/lib/

```



### enable-agent.shé…ç½®

é—®é¢˜æè¿°

- hdfså’Œyarnæ’ä»¶å®‰è£…éƒ¨ç½²åï¼Œæ’ä»¶jaråŒ…ä¼šéƒ¨ç½²åˆ°ç»„ä»¶å®‰è£…ç›®å½•çš„share/hadoop/hdfs/libå­ç›®å½•ä¸‹ï¼Œå¯åŠ¨hdfsæˆ–yarnè¿è¡Œæ—¶åŠ è½½ä¸åˆ°è¿™äº›jaråŒ…ï¼Œä¼šæŠ¥ClassNotFoundException: Class org.apache.ranger.authorization.yarn.authorizer.RangerYarnAuthorizer not found



è§£å†³åŠæ³•

ä¿®æ”¹agents-commonæ¨¡å—enable-agent.shè„šæœ¬æ–‡ä»¶ï¼š

- å°†

```shell

    208     HCOMPONENT_LIB_DIR=${HCOMPONENT_INSTALL_DIR}/share/hadoop/hdfs/lib

    234     HCOMPONENT_CONF_DIR=${HCOMPONENT_INSTALL_DIR}/config


```

ä¿®æ”¹ä¸ºï¼š

```shell

    208     HCOMPONENT_LIB_DIR=${HCOMPONENT_INSTALL_DIR}

    234     HCOMPONENT_CONF_DIR=${PROJ_LIB_DIR}/ranger-kafka-plugin-impl

```







### æ”¹install.properties

```properties
POLICY_MGR_URL=http://192.168.4.50:6080

REPOSITORY_NAME=yarndev

## ä¸‹é¢è¿™ä¸ªé»˜è®¤æ˜¯hadoop ï¼Œæˆ‘æ”¾åˆ°äº†cdh çš„libç›®å½•ä¸‹ï¼Œå¯¹äºç›®å½•å°±æ˜¯å­ç›®å½• hadoop ï¼Œä¸ç”¨æ”¹
## COMPONENT_INSTALL_DIR_NAME=/opt/cloudera/parcels/CDH-6.3.2-1.cdh6.3.2.p0.1605554/lib/hadoop

```

æˆ‘åªæ”¹äº†è¿™ä¿©ï¼Œæ²¡å¼€solr å®¡è®¡ï¼Œæ²¡æ”¹ç”¨æˆ·ï¼Œå¯¹åº”çš„ ç”¨æˆ·ä¸ºé»˜è®¤ yarn ï¼Œç»„hadoop







### å¯åŠ¨



```shell
./enable-yarn-plugin.sh 

```





### ä¿®æ”¹yarn-site.xmlé…ç½®æ–‡ä»¶



YARNæ’ä»¶å®‰è£…åœ¨æ‰€æœ‰ResourceManagerèŠ‚ç‚¹æœåŠ¡å™¨ä¸Š





åœ¨CDHç®¡ç†ç•Œé¢é…ç½®YARNå‚æ•°ï¼Œé…ç½®â€œ**yarn-site.xml** çš„ **ResourceManager** é«˜çº§é…ç½®ä»£ç æ®µâ€ï¼Œæ–°å¢å‚æ•°é…ç½®ï¼š

yarn.authorization-provider=org.apache.ranger.authorization.yarn.authorizer.RangerYarnAuthorizer



cdh yarn é«˜çº§é‡Œæ·»åŠ 

æ·»åŠ å¦‚ä¸‹å±æ€§ï¼š

```xml
<property>

  <name>yarn.acl.enable</name>

  <value>true</value>

</property>

<property>

  <name>yarn.authorization-provider</name>

  <value>org.apache.ranger.authorization.yarn.authorizer.RangerYarnAuthorizer</value>

</property>
```







# rangeræapi åŒ…ä¸€å±‚çš®



Apache Ranger is a framework to enable, monitor and manage comprehensive data security across the Hadoop platform. Apache Ranger currently provides a centralized security adminstration, fine grain access control and detailed auditing for user access within Apache Hadoop, Apache Hive, Apache HBase and other Apache components





apiç›®å‰åªæœ‰0.6ç‰ˆæœ¬

https://cwiki.apache.org/confluence/display/RANGER/Apache+Ranger+0.6+-+REST+APIs+for+Service+Definition,+Service+and+Policy+Management



2.1ç‰ˆæœ¬api

http://ranger.apache.org/apidocs/ui/index.html





```shell


USR_CONFIG=$1
RANGER_URL=22.188.12.73:6080
ADMIN_PASSWD=Bdp@boc01!

## å‘é€åˆ›å»ºç”¨æˆ·curl -u admin:${ADMIN_PASSWD} -v -i -s -X POST -H "Accept: application/json" -H "Content-Type: application/json" http://${RANGER_URL}/service/xusers/secure/users -d@${USR_CONFIG}


## 

```



## **åˆ›å»ºç»„**

```shell
curl -u admin:Bdp@boc01! -v -i -s -H "Accept: application/json" -H "Content-Type: application/json" -X POST 'http://22.188.12.73:6080/service/xusers/secure/groups' -d '{"name":"iisp22","description":"iisp - add from bft_manager"}'



curl -u admin:Bdp@boc01! --request POST 'http://22.188.12.73:6080/service/xusers/secure/groups' \
--header 'Content-Type: application/json' \
--data-raw '{"name":"iisp","description":"iisp - add from bft_manager"}'
```



* groupSource:0è¡¨ç¤º**Internal**ï¼Œ1è¡¨ç¤º**External**





## **åˆ›å»ºç”¨æˆ·**



```shell
curl -u admin:Bdp@boc01! -v -i -s -X POST -H "Accept: application/json" -H "Content-Type: application/json" http://22.188.12.73:6080/service/xusers/secure/users -d@userfile.json

curl -u admin:Bdp@boc01! -v -i -s -X POST -H "Accept: application/json" -H "Content-Type: application/json" http://22.188.12.73:6080/service/xusers/secure/users -d '{ "name":"mqddd", 
 "firstName":"mqeee", 
 "lastName": "mqccc",
 "loginId": "mqccc", 
 "emailAddress" : null, 
 "description" : "mqccc - add fromambari", 
 "password" : "Bdp@boc01!", 
 "groupIdList":[ "hadoop" ],
 "status":1, 
 "isVisible":1, 
 "userRoleList": [ "ROLE_USER" ], 
 "userSource":1 }'


```



æ³¨æ˜ï¼š@userfile.jsonæ–‡ä»¶ä¹Ÿå¯ä»¥ç”¨jsonæ ¼å¼å­—ç¬¦ä¸²æ›¿æ¢ -d â€˜{... ...}â€™

æ³¨æ˜ï¼šæŸäº›æ¥å£å¯èƒ½éœ€è¦ç§»é™¤/secure

æ³¨æ˜2ï¼šuserfile.jsonå†…å®¹ä¸¾ä¾‹å¦‚ä¸‹



```json
{ "name":"mqddd", 
 "firstName":"mqccc", 
 "lastName": "mqccc",
 "loginId": "mqccc", 
 "emailAddress" : null, 
 "description" : "mqccc - add fromambari", 
 "password" : "Bdp@boc01!", 
 "groupIdList":["hadoop"],
 "status":1, 
 "isVisible":1, 
 "userRoleList": [ "ROLE_USER" ], 
 "userSource":1 }
```





userRoleListå–å€¼ï¼š"**ROLE_SYS_ADMIN**" æˆ– "**ROLE_USER**"

ç§»é™¤å¯†ç å­—æ®µï¼Œç”¨æˆ·å°†å˜æˆ**External**ç”¨æˆ·

"userSource":0è¡¨ç¤º**Internal**ï¼Œ1è¡¨ç¤º**External**



## åˆ›å»ºpolicy

```shell
## ç™»é™†æ¨¡å¼
curl --location --request POST 'http://22.188.12.73:6080/service/plugins/policies' \
--header 'Content-Type: application/json' \
--header 'Cookie: RANGERADMINSESSIONID=1EAD5E79135EE8524DFE1B7AC93D62DC' \
--data-raw '{"policyType":"0","name":"ssss","isEnabled":true,"policyPriority":0,"policyLabels":[],"description":"","isAuditEnabled":true,"resources":{"database":{"values":["bdp"],"isRecursive":false,"isExcludes":false},"table":{"values":["mqtest"],"isRecursive":false,"isExcludes":false},"column":{"values":["col2"],"isRecursive":false,"isExcludes":false}},"isDenyAllElse":false,"policyItems":[{"users":["bdp"],"accesses":[{"type":"select","isAllowed":true},{"type":"update","isAllowed":true},{"type":"create","isAllowed":true},{"type":"drop","isAllowed":true},{"type":"alter","isAllowed":true},{"type":"index","isAllowed":true},{"type":"lock","isAllowed":true},{"type":"all","isAllowed":true},{"type":"read","isAllowed":true},{"type":"write","isAllowed":true},{"type":"repladmin","isAllowed":true},{"type":"serviceadmin","isAllowed":true},{"type":"tempudfadmin","isAllowed":true},{"type":"refresh","isAllowed":true}]}],"allowExceptions":[],"denyPolicyItems":[],"denyExceptions":[],"service":"hivedev"} '




## å¯†é’¥æ¨¡å¼

curl -u admin:Bdp@boc01! --request POST 'http://22.188.12.73:6080/service/plugins/policies' \
--header 'Content-Type: application/json' \
--data-raw '{"policyType":"0","name":"ssss2","isEnabled":true,"policyPriority":0,"policyLabels":[],"description":"","isAuditEnabled":true,"resources":{"database":{"values":["bdp222"],"isRecursive":false,"isExcludes":false},"table":{"values":["mqtest"],"isRecursive":false,"isExcludes":false},"column":{"values":["col2"],"isRecursive":false,"isExcludes":false}},"isDenyAllElse":false,"policyItems":[{"users":["bdp"],"accesses":[{"type":"select","isAllowed":true},{"type":"update","isAllowed":true},{"type":"create","isAllowed":true},{"type":"drop","isAllowed":true},{"type":"alter","isAllowed":true},{"type":"index","isAllowed":true},{"type":"lock","isAllowed":true},{"type":"all","isAllowed":true},{"type":"read","isAllowed":true},{"type":"write","isAllowed":true},{"type":"repladmin","isAllowed":true},{"type":"serviceadmin","isAllowed":true},{"type":"tempudfadmin","isAllowed":true},{"type":"refresh","isAllowed":true}]}],"allowExceptions":[],"denyPolicyItems":[],"denyExceptions":[],"service":"hivedev"} '
```















## **è·å–ç”¨æˆ·ä¿¡æ¯**



æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ï¼Œä¸åŒ…å«ä¸groupå…³ç³»

curl -u admin:admin -v -i -s -H "Accept: application/json" -H "Content-Type: application/json" -X GET http://<ranger_host_address>:6080/service/xusers/users/userName/zhouyuan

æ ¹æ®ç”¨æˆ·IDæŸ¥è¯¢ï¼ŒåŒ…å«ä¸groupå…³ç³»ï¼ˆå¯ä»¥æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢è·å–ç”¨æˆ·IDï¼‰

curl -u admin:admin -v -i -s -H "Accept: application/json" -H "Content-Type: application/json" -X GET http://<ranger_host_address>:6080/service/xusers/secure/users/{id}



## **åˆ é™¤ç”¨æˆ·**

è½¯åˆ é™¤(å³å°†ç”¨æˆ·çŠ¶æ€è®¾ä¸ºHidden)

curl -u admin:admin -v -i -s -H "Accept: application/json" -H "Content-Type: application/json" -X DELETE[http://:6080/service/xusers/users/userName/zhouyuan](http://172.16.70.55:6080/service/xusers/users/userName/zhouyuan)

ç¡¬åˆ é™¤

URLæœ«å°¾æ·»åŠ å‚æ•°ï¼šforceDelete=trueï¼Œå³

curl -u admin:admin -v -i -s -H "Accept: application/json" -H "Content-Type: application/json" -X DELETE [http://:6080/service/xusers/users/userName/zhouyuan](http://172.16.70.55:6080/service/xusers/users/userName/zhouyuan)?forceDelete=true



## **æŸ¥è¯¢ç»„**



æ¨¡ç³Šæœç´¢(å¯èƒ½è¿”å›åˆ—è¡¨)ï¼š

curl -u admin:admin -v -i -s -H "Accept: application/json" -H "Content-Type: application/json" -X GET http://<ranger_host_address>:6080/service/xusers/groups?name=group1



ç²¾ç¡®è·å–æ­¤ç¾¤ä¿¡æ¯ï¼š

curl -u admin:admin -v -i -s -H "Accept: application/json" -H "Content-Type: application/json" -X GET[http://:6080/service/xusers/groups/groupName/group1](https://blog.csdn.net/ZhouyuanLinli/article/details/78617289)



## **åˆ é™¤ç»„**

curl -u admin:admin -v -i -s -H "Accept: application/json" -H "Content-Type: application/json" -X DELETE [http://:6080/service/xusers/groups](https://blog.csdn.net/ZhouyuanLinli/article/details/78617289)/groupName/{groupName}



åŒåˆ é™¤ç”¨æˆ·ä¸€æ ·ï¼Œåˆ†è½¯åˆ é™¤å’Œç¡¬åˆ é™¤



## **ç»„æ›´æ–°ç”¨æˆ·æˆå‘˜**

1ã€æ·»åŠ æ–¹å¼ï¼šAmbariä¸­ç»„æ·»åŠ ç”¨æˆ·ï¼ŒRangerç”¨æˆ·æ·»åŠ ç»„

2ã€Ambariå·²é‡‡ç”¨pythonè„šæœ¬å®ç°äº†ä¸LDAPç”¨æˆ·åŒæ­¥

3ã€Ambariç”¨æˆ·å˜æ›´å‰åï¼Œè¯†åˆ«å“ªäº›ç”¨æˆ·æ–°å¢åˆ°æ­¤ç»„ï¼Œå“ªäº›ç”¨æˆ·ä¸å˜ï¼ˆä¸ç®¡ï¼‰ï¼Œå“ªäº›ç”¨æˆ·è§£ç»‘æ­¤ç»„ã€‚ï¼ˆéœ€è¦æŸ¥è¯¢ä¸€æ¬¡è¿›è¡Œä¿®æ”¹å‰åç”¨æˆ·å¯¹æ¯”ï¼‰

4ã€æ¯ä¸ªæ–°å¢/è§£ç»‘ç”¨æˆ·è°ƒç”¨rangeræ¥å£ï¼Œè·å–ç”¨æˆ·ä¿¡æ¯ä»è€ŒçŸ¥é“ç”¨æˆ·{id}ï¼Œè·å–ç¾¤ç»„{id}, putæ¶ˆæ¯ä¿®æ”¹ç”¨æˆ·groupIdListå­—æ®µï¼ˆå…¶ä»–å­—æ®µä¸å˜ï¼‰

curl -u admin:admin -v -i -s -X PUT -H "Accept: application/json" -H "Content-Type: application/json" http://<ranger_host_address>:6080/service/xusers/secure/users/{id} -d@userfile.json

